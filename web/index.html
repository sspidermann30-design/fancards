<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            background: #121212; color: white; font-family: 'Segoe UI', sans-serif;
            margin: 0; padding-top: 70px; display: flex; flex-direction: column; align-items: center;
        }

        /* --- –®–ê–ü–ö–ê –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø --- */
        header {
            position: fixed; top: 0; width: 100%; height: 60px;
            background: #1e1e1e; display: flex; align-items: center;
            justify-content: space-between; padding: 0 20px; box-sizing: border-box;
            border-bottom: 2px solid #333; z-index: 1000;
        }
        .logo { font-weight: 900; letter-spacing: 2px; color: #fff; font-size: 18px; }
        .balance { background: #2c2c2c; padding: 5px 12px; border-radius: 15px; font-size: 14px; border: 1px solid #ffcc00; color: #ffcc00; }

        /* --- –ö–û–ù–¢–ï–ù–¢ --- */
        .screen { display: none; width: 100%; flex-direction: column; align-items: center; padding: 20px; box-sizing: border-box; }
        .active { display: flex; }

        h1 { font-size: 32px; margin-bottom: 30px; text-align: center; color: #fff; text-shadow: 0 0 10px rgba(255,255,255,0.2); }

        /* --- –ö–ù–û–ü–ö–ò –ú–ï–ù–Æ --- */
        .menu-btn {
            width: 90%; max-width: 300px; padding: 15px; margin-bottom: 15px;
            background: #1e1e1e; border: 1px solid #444; color: white;
            border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer; text-align: center;
        }
        .primary-btn { background: white; color: black; border: none; }

        /* --- –°–ï–¢–ö–ê –ö–û–õ–õ–ï–ö–¶–ò–ò --- */
        .collection-grid {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; width: 100%; max-width: 350px;
        }
        .mini-card {
            aspect-ratio: 2/3; background: #1e1e1e; border: 2px solid #444; border-radius: 8px;
            background-size: cover; background-position: center; cursor: pointer;
        }

        /* --- –ö–ê–†–¢–û–ß–ö–ê (–ü–û–õ–ù–ê–Ø) --- */
        .rarity-text { font-size: 11px; color: #888; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 2px; }
        .image-frame { width: 210px; height: 300px; border: 5px solid #555; border-radius: 20px; overflow: hidden; background: #000; }
        .card-img { width: 100%; height: 100%; background-size: cover; background-position: center; }
        .info { text-align: center; margin-top: 15px; }

        /* –ë–£–†–ì–ï–† (–ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ) */
        .nav-footer { position: fixed; bottom: 20px; display: flex; gap: 10px; }
        .nav-btn { background: #222; border: 1px solid #444; color: #aaa; padding: 10px 15px; border-radius: 10px; font-size: 12px; }

    </style>
</head>
<body>

    <header>
        <div class="logo">FANCARDS</div>
        <div class="balance">üí∞ <span id="coin-count">50000</span></div>
    </header>

    <div id="screen-main" class="screen active">
        <h1>FANCARDS</h1>
        <button class="menu-btn primary-btn" onclick="openPack()">üéÅ –ï–ñ–ï–î–ù–ï–í–ù–´–ô –ü–ê–ö</button>
        <button class="menu-btn" onclick="showScreen('screen-collection')">üóÇ –ú–û–Ø –ö–û–õ–õ–ï–ö–¶–ò–Ø</button>
        <button class="menu-btn" onclick="showScreen('screen-market')">‚öñÔ∏è –†–´–ù–û–ö</button>
    </div>

    <div id="screen-collection" class="screen">
        <h1>–ö–û–õ–õ–ï–ö–¶–ò–Ø</h1>
        <div class="collection-grid" id="collection-grid">
            </div>
        <button class="nav-btn" style="margin-top:20px" onclick="showScreen('screen-main')">–í –ú–ï–ù–Æ</button>
    </div>

    <div id="screen-card" class="screen">
        <div class="rarity-text" id="r-val"></div>
        <div class="image-frame"><div class="card-img" id="c-img"></div></div>
        <div class="info">
            <h2 id="c-name" style="margin:0"></h2>
            <p id="c-phrase" style="font-style:italic; color:#aaa"></p>
        </div>
        <button class="menu-btn" style="margin-top:20px" onclick="showScreen('screen-collection')">–ó–ê–ö–†–´–¢–¨</button>
    </div>

    <div id="screen-market" class="screen">
        <h1>–†–´–ù–û–ö</h1>
        <p style="color:#666">–ó–¥–µ—Å—å —Å–∫–æ—Ä–æ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç —Ç–æ—Ä–≥–æ–≤–∞—Ç—å...</p>
        <button class="nav-btn" onclick="showScreen('screen-main')">–í –ú–ï–ù–Æ</button>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();

        // –î–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∞ (–∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –ø–∞–º—è—Ç–∏ –∏–ª–∏ —Å—Ç–∞—Ä—Ç)
        let coins = parseInt(localStorage.getItem('coins')) || 50000;
        let myCards = JSON.parse(localStorage.getItem('myCards')) || [];

        updateUI();

        function updateUI() {
            document.getElementById('coin-count').innerText = coins;
            localStorage.setItem('coins', coins);
            localStorage.setItem('myCards', JSON.stringify(myCards));
            renderCollection();
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        async function openPack() {
            tg.HapticFeedback.impactOccurred('heavy');
            const urlParams = new URLSearchParams(window.location.search);
            const cardId = urlParams.get('id') || 1;

            try {
                const response = await fetch('cards.json?v=' + Date.now());
                const cards = await response.json();
                const character = cards.find(c => c.id == cardId);

                if (character) {
                    // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é, –µ—Å–ª–∏ –µ—ë —Ç–∞–º –Ω–µ—Ç
                    if (!myCards.includes(character.id)) {
                        myCards.push(character.id);
                    }

                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞—Ä—Ç—É
                    document.getElementById('c-name').innerText = character.name;
                    document.getElementById('c-phrase').innerText = character.phrase;
                    document.getElementById('r-val').innerText = character.rarity;
                    document.getElementById('c-img').style.backgroundImage = `url('${character.image}')`;

                    showScreen('screen-card');
                    updateUI();
                }
            } catch (e) { console.error(e); }
        }

        function renderCollection() {
            const grid = document.getElementById('collection-grid');
            grid.innerHTML = '';

            // –í —Ä–µ–∞–ª—å–Ω–æ–π –∏–≥—Ä–µ –º—ã –±—ã –ø–æ–¥—Ç—è–≥–∏–≤–∞–ª–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑ cards.json –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ä—Ç—ã –≤ myCards
            fetch('cards.json').then(res => res.json()).then(allCards => {
                myCards.forEach(id => {
                    const card = allCards.find(c => c.id == id);
                    if(card) {
                        const div = document.createElement('div');
                        div.className = 'mini-card';
                        div.style.backgroundImage = `url('${card.image}')`;
                        div.onclick = () => {
                            document.getElementById('c-name').innerText = card.name;
                            document.getElementById('c-phrase').innerText = card.phrase;
                            document.getElementById('r-val').innerText = card.rarity;
                            document.getElementById('c-img').style.backgroundImage = `url('${card.image}')`;
                            showScreen('screen-card');
                        };
                        grid.appendChild(div);
                    }
                });
            });
        }
    </script>
</body>
</html>