<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FanCards Game</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: #0d0d0d;
            --card-bg: #1a1a1a;
            --gold: #ffd700;
            --text-color: #ffffff;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        #app { width: 100%; max-width: 500px; height: 100%; display: flex; flex-direction: column; }

        header { padding: 20px; text-align: center; border-bottom: 2px solid var(--gold); background: #111; }

        .balance-container { font-size: 24px; font-weight: bold; color: var(--gold); }

        .menu { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 20px; }

        .menu-item {
            background: var(--card-bg);
            border: 1px solid #333;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
        }

        .screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-color); z-index: 100; display: none; flex-direction: column; padding: 20px; box-sizing: border-box; }

        /* –î–∏–∑–∞–π–Ω –∫–∞—Ä—Ç–æ—á–∫–∏ */
        #c-img { width: 280px; height: 380px; background-size: cover; background-position: center; border-radius: 15px; border: 2px solid #333; margin: 0 auto; }

        .btn-gold { background: var(--gold); color: black; border: none; padding: 12px; border-radius: 20px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; }
    </style>
</head>
<body>

<div id="app">
    <header>
        <div id="user-greeting" style="font-size: 12px; color: #888;"></div>
        <div class="balance-container">‚ú® <span id="balance">0</span></div>
    </header>

    <div class="menu">
        <div class="menu-item" onclick="openDaily()">üéÅ –ï–ñ–ï–î–ù–ï–í–ù–´–ô –ü–ê–ö</div>
        <div class="menu-item" onclick="showScreen('screen-shop')">üõí –ú–ê–ì–ê–ó–ò–ù</div>
        <div class="menu-item" onclick="showScreen('screen-collection')" style="grid-column: span 2;">üìö –ú–û–Ø –ö–û–õ–õ–ï–ö–¶–ò–Ø</div>
    </div>
</div>

<div id="screen-shop" class="screen">
    <h2>–ú–ê–ì–ê–ó–ò–ù</h2>
    <div class="menu-item" onclick="buyPack('Basic Pack', 500)">üì¶ Basic Pack (500 üí∞)</div>
    <button class="btn-gold" onclick="hideScreens()">–ù–ê–ó–ê–î</button>
</div>

<div id="screen-collection" class="screen">
    <h2>–ú–û–Ø –ö–û–õ–õ–ï–ö–¶–ò–Ø</h2>
    <div id="collection-list" style="overflow-y: auto; flex-grow: 1;"></div>
    <button class="btn-gold" onclick="hideScreens()">–ù–ê–ó–ê–î</button>
</div>

<div id="screen-card" class="screen" style="align-items: center; justify-content: center; background: rgba(0,0,0,0.95);">
    <div id="c-img"></div>
    <div style="text-align:center; width: 280px; margin-top: 15px;">
        <div id="c-series" style="color: var(--gold); font-size: 12px; font-weight: bold; text-transform: uppercase;"></div>
        <h2 id="c-name" style="margin: 5px 0;"></h2>
        <p id="c-phrase" style="font-style: italic; color: #aaa; font-size: 14px;"></p>
        <div style="font-size: 12px; color: #777;">–†–ï–î–ö–û–°–¢–¨: <span id="r-val" style="color:var(--gold)"></span></div>
    </div>
    <button class="btn-gold" style="width: 200px;" onclick="closeCard()">–ó–ê–ö–†–´–¢–¨</button>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    // --- –î–ê–ù–ù–´–ï (–ë–ï–ó –î–£–ë–õ–ò–ö–ê–¢–û–í) ---
    const adminIds = [994661814, 7049962197];
    const userId = tg.initDataUnsafe?.user?.id;

    let coins = localStorage.getItem('coins') ? parseInt(localStorage.getItem('coins')) : (adminIds.includes(userId) ? 50000 : 0);
    let myCards = localStorage.getItem('fancards_inv') ? JSON.parse(localStorage.getItem('fancards_inv')) : {};
    let pendingCards = [];

    document.getElementById('user-greeting').innerText = "–ü—Ä–∏–≤–µ—Ç, " + (tg.initDataUnsafe?.user?.first_name || "–í–æ–ª—à–µ–±–Ω–∏–∫");

    // --- –ù–ê–í–ò–ì–ê–¶–ò–Ø ---
    function showScreen(id) {
        hideScreens();
        document.getElementById(id).style.display = 'flex';
        if(id === 'screen-collection') updateCollectionUI();
    }

    function hideScreens() {
        document.querySelectorAll('.screen').forEach(s => s.style.display = 'none');
    }

    // --- –õ–û–ì–ò–ö–ê ---
    function openDaily() {
        const last = localStorage.getItem('last_daily');
        if (last && (Date.now() - last < 86400000)) {
            alert("–ü–∞–∫ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –∑–∞–≤—Ç—Ä–∞!"); return;
        }
        fetch('cards.json').then(r => r.json()).then(cards => {
            const card = cards[Math.floor(Math.random() * cards.length)];
            addCard(card);
            localStorage.setItem('last_daily', Date.now());
            showCharacter(card);
        });
    }

    function buyPack(name, price) {
        if (coins < price) { alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!"); return; }
        coins -= price;
        openDaily(); // –î–ª—è –ø—Ä–∏–º–µ—Ä–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –ø–∞–∫
        updateUI();
    }

    function addCard(card) {
        myCards[card.id] = (myCards[card.id] || 0) + 1;
        updateUI();
    }

    function showCharacter(card) {
        document.getElementById('c-name').innerText = card.name;
        document.getElementById('c-series').innerText = card.series || "–ë–ê–ó–û–í–ê–Ø –°–ï–†–ò–Ø";
        document.getElementById('c-phrase').innerText = card.phrase ? `"${card.phrase}"` : "";
        document.getElementById('r-val').innerText = card.rarity;
        document.getElementById('c-img').style.backgroundImage = `url('${card.image}')`;
        document.getElementById('screen-card').style.display = 'flex';
    }

    function closeCard() {
        document.getElementById('screen-card').style.display = 'none';
    }

    function updateUI() {
        document.getElementById('balance').innerText = coins;
        localStorage.setItem('coins', coins);
        localStorage.setItem('fancards_inv', JSON.stringify(myCards));
    }

    function updateCollectionUI() {
        const list = document.getElementById('collection-list');
        list.innerHTML = "";
        for (let id in myCards) {
            list.innerHTML += `<div class="menu-item">–ö–∞—Ä—Ç–∞ ID: ${id} (x${myCards[id]})</div>`;
        }
    }

    updateUI();
</script>
</body>
</html>